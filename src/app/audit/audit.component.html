<div class="main_content p-0">
  <div class="page-content flex-grow-1 {{cursorWaiting === true ?'pagewait':''}}">
    <ul class="nav pt-2 bg-white tab-lined nav-tabs" id="myTab" role="tablist" (click)="onChangeTab($event)">
      <li class="nav-item">
        <a class="nav-link active" id="allPipeline" data-toggle="tab" role="tab" aria-controls="allPipeline"
          aria-selected="false">Pipeline Execution</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="Pipeline" data-toggle="tab" role="tab" aria-controls="Pipeline"
          aria-selected="true">Pipeline</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="Policy" data-toggle="tab" role="tab" aria-controls="Policy" aria-selected="false">Policy
          Audit</a>
      </li>
    </ul>

    <!-- code for displaying the pipeline overallinfo starts here -->

    <div class="pt-3"
      *ngIf="currentTabData !== null && currentTabData['results'].length > 0 && relatedApi === 'pipeline'">
      <div class="summary-list">
        <div class="summary-item">
          <div class="row">
          <div class="col-md-9">
            <h5>Pipeline Runs</h5>
          </div>
          <div class="col-md-2">
            <h3>{{totalPipelineRunsCount}}</h3>
          </div>
          </div>
        </div>
        <div class="summary-item">
          <div class="row">
          <div  class="col-md-9">
            <h5>Successful Runs</h5>
          </div>
          <div class="col-md-2">
            <h3>{{successfulPipelineRunsCount}}</h3>
          </div>
          </div>
        </div>
        <div class="summary-item">
          <div class="row">
          <div  class="col-md-9">
            <h5>Failed Runs</h5>
          </div>
          <div class="col-md-2">
            <h3>{{failedPipelineRunsCount}}</h3>
          </div>
          </div>
        </div>
        <div class="summary-item">
          <div class="row">
          <div class="col-md-9">
            <h5>Canceled Runs</h5>
          </div>
          <div class="col-md-2">
            <h3>{{cancelledPipelineRunsCount}}</h3>
          </div>
          </div>
        </div>
      </div>
    </div>

    <!-- code for displaying the pipeline overallinfo ends here -->


    <!-- code for displaying the pipeline config overallinfo starts here -->

    <div class="pt-3 col-12"
      *ngIf="currentTabData !== null && currentTabData['results'].length > 0 && relatedApi === 'pipelineconfig'">
      <div class="summary-list">
        <div class="summary-item">
          <div class="row">
          <div class="col-md-9">
            <h5>{{pipelineCountName}}</h5>
          </div>
          <div class="col-md-2">
            <h3>{{pipelineCountValue}}</h3>
          </div>
          </div>
        </div>
      </div>
    </div>

    <!-- code for displaying the pipeline config overallinfo ends here -->

        <!-- code for displaying the policy audi overallinfo starts here -->

        <div class="pt-3 col-12"
        *ngIf="currentTabData !== null && currentTabData['results'].length > 0 && relatedApi === 'policies'">
        <div class="summary-list">
          <div class="summary-item">
            <div class="row">
            <div class="col-md-9">
              <h5>{{pipelineCountName}}</h5>
            </div>
            <div class="col-md-2">
              <h3>{{pipelineCountValue}}</h3>
            </div>
            </div>
          </div>
        </div>
      </div>
  
      <!-- code for displaying the policy audit overallinfo ends here -->

    <div class="p-3">
      <div class="row no-gutters">
        <div class="col-12">
          <ng-container *ngIf="!auditLoading">
            <div class="card" *ngIf="currentTabData !== null && currentTabData['results'].length > 0">
              <div class="card-heading mb-form-db">
                <div class="form-inline">
                  <ng-container *ngIf="advanSearchMode">
                    <div class="form-group ml-sm-2 mb-2">
                      <select class="form-control" style="width: 150px;" [(ngModel)]="selectedSaveFilter"
                        (change)="onSelectSavedFilter()">
                        <option value="">Select saved filter</option>
                        <option *ngFor="let filter of savedFilters" value="{{filter}}">{{filter}}</option>
                      </select>
                    </div>

                    <div class="form-group ml-sm-2 mb-2">
                      <div class="form-group">
                        <div class="dropdown dropdown-icon-remove" data-toggle="tooltip" data-placement="top"
                          title="Add More Filters">
                          <button class="btn btn-default dropdown-toggle addmorefilter" type="button" #AddMoreFilters
                            id="addMoreFilters" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-filter">+</i>
                          </button>
                          <div class="dropdown-menu dropdown-menu-filter dropdown-filter dropdown-menu-right"
                            aria-labelledby="addMoreFilters">
                            <form #filtersShowHide="ngForm">
                              <div class="custom-control custom-checkbox"
                                *ngFor="let filter of filtersData; let i=index">
                                <input type="checkbox" class="custom-control-input" (change)="showHideFilters($event,i)"
                                  [checked]="showHideFilter[i]" id="showHide{{i}}">
                                <label class="custom-control-label"
                                  for="showHide{{i}}">{{currentTableHeader[filter.name]}}</label>
                              </div>
                              <div class="dropdown-footer dropdown-footer-border">
                                <button class="btn text-left btn-block btn-link" *ngIf="filtersData.length > 0"
                                  (click)="showHideFilters($event,'selectAll')">Select All</button>
                                <div class="addFilter" *ngIf="filtersData.length === 0"><span>Data not avaliable</span>
                                </div>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group mx-sm-2 mb-2">
                      <div class="btn-group dropdown-icon-remove" role="group"
                        aria-label="Button group with nested dropdown">
                        <div class="btn-group" role="group">
                          <button id="btnGroupDrop2" type="button" class="btn btn-default" #SaveFilter
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Save Filter
                          </button>
                          <div class="dropdown-menu p-0 dropdown-save-filter" aria-labelledby="btnGroupDrop2">
                            <form [formGroup]="saveFilterForm">
                              <div class="dropdown-menu-header py-3 px-3 d-flex align-items-center">
                                <h6>Save New Filter</h6>
                                <button type="button" class="close ml-auto">
                                  <i class="fa fa-times"></i>
                                </button>
                              </div>
                              <div class="dropdown-menu-body mt-3 mb-2 px-3">
                                <div class="form-row align-items-center">
                                  <div class="col-auto mb-2">
                                    <input type="text" class="form-control" formControlName="filterName"
                                      [ngClass]="saveFilterForm.get('filterName').invalid && saveFilterForm.get('filterName').touched ? 'is-invalid':''" />
                                    <span
                                      *ngIf="saveFilterForm.get('filterName').invalid && saveFilterForm.get('filterName').touched"
                                      class="invalid-feedback">
                                      <span *ngIf="saveFilterForm.get('filterName').errors['required']">Filter Name is
                                        required</span>
                                      <span *ngIf="saveFilterForm.get('filterName').errors['filterExist']">Filter
                                        already
                                        exists with same name. Please choose a unique filter name</span>
                                    </span>
                                  </div>
                                  <div class="col-auto">
                                    <button type="submit" class="btn btn-outline-secondary mb-2"
                                      (click)="saveFilter($event)">Save</button>
                                  </div>
                                </div>
                              </div>
                            </form>
                          </div>
                        </div>
                        <div class="btn-group" role="group" data-toggle="tooltip" data-placement="top"
                          title="Saved Filters">
                          <button id="btnGroupDrop1" type="button" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-ellipsis-h"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1">
                            <li class="dropdown-item d-flex align-items-center" *ngFor="let filter of savedFilters">
                              {{filter}}<button class="btn text-muted ml-auto p-0 pl-2"><i
                                  (click)="deleteSavedFilter(filter)" class="fas fa-trash-alt"></i></button></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="!advanSearchMode">
                    <div class="form-group mx-sm-2 mb-2">
                      <div class="form-group">
                        <!-- <div class="input-group input-group_search">
                          <div class="input-group-prepend">
                            <span class="input-group-text" id="modal-search"><i class="fa fa-search"></i></span>
                          </div>
                          <input type="text" class="form-control" placeholder="Search" [(ngModel)]="searchData"
                            (keyup)="onSearch()">
                        </div> -->
                        <opsmx-search *ngIf="currentDatalength>0" [searchBoxParams]="searchParams" (filteredList)="getSerchItem($event)">
                        </opsmx-search>
                      </div>
                    </div>
                  </ng-container>
                  <button type="submit" *ngIf="!advanSearchMode" class="btn btn-default mb-2"
                    (click)="advancedModeToggle()" data-toggle="tooltip" data-placement="top"
                    title="Switch to advanced search"><img src="../../assets/images/code-icon.png" alt="icon"
                      style="display: block; margin: 4px 0px;" /></button>
                  <button type="submit" *ngIf="advanSearchMode" class="btn btn-default mb-2"
                    (click)="advancedModeToggle()" data-toggle="tooltip" data-placement="top"
                    title="Switch to basic search"><img src="../../assets/images/code-icon.png" alt="icon"
                      style="display: block; margin: 4px 0px;" /></button>
                  <button type="submit" class="btn btn-default mb-2 ml-sm-2" *ngIf="selectedSaveFilter !== ''"
                    (click)="resetFilters()" data-toggle="tooltip" data-placement="top" title="Clear filter"><i
                      class="fa fa-redo"></i> &nbsp;Clear</button>

                  <div class="ml-auto d-flex">
                    <div class="form-group mb-2">
                      <div class="mr-3">
                        <opsmx-select [params]="dateRangeParams" (changed)="filterDateAudit($event.target.value)">
                        </opsmx-select>
                      </div>
                      <div class="dropdown dropdown-icon-remove" data-toggle="tooltip" data-placement="left"
                        title="Show/Hide Columns">
                        <button class="btn btn-default dropdown-toggle" type="button" #CustomColumn
                          data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="fas fa-icon-rotate fa-bars"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-filter dropdown-filter dropdown-menu-right"
                          aria-labelledby="dropdownMenuButton">
                          <form #customizeColumnForm="ngForm">
                            <div class="custom-control custom-checkbox"
                              *ngFor="let columnName of currentHeaderKeys; let i=index">
                              <input type="checkbox" class="custom-control-input" (change)="customizeColumn($event,i)"
                                [disabled]="i<3" [checked]="showColumn[i] === 'true'" id="{{columnName}}">
                              <label class="custom-control-label"
                                for="{{columnName}}">{{currentTableHeader[columnName]}}</label>
                            </div>
                            <div class="dropdown-footer dropdown-footer-border">
                              <button class="btn text-left btn-block btn-link"
                                (click)="customizeColumn($event,'selectAll')">Select All</button>
                            </div>
                          </form>
                          <!-- /.dropdown-footer -->
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- /.form-inline -->
                <!-- #### Don't delete need in future toolpills ##### -->
                <div class="toolpills">
                  <form #filterForm="ngForm" class="filterForm">
                    <ng-container *ngFor="let filter of filtersData;let i = index">
                      <div class="form-group ml-sm-2 mb-2 btn" *ngIf="showHideFilter[i]" data-toggle="tooltip"
                        data-placement="top" title="{{currentTableHeader[filter.name]}}">
                        <ng-multiselect-dropdown [placeholder]="currentTableHeader[filter.name]"
                          name="{{filtersData[i].name}}" [data]="filter.items" [settings]="dropdownSettings"
                          (onSelect)="onItemSelect($event,filter)" [(ngModel)]="selectedFilters[i]"
                          (onSelectAll)="onItemSelect($event,filter)" (onDeSelectAll)="onItemSelect($event,filter)"
                          (onDeSelect)="onItemSelect($event,filter)" ngModel>
                        </ng-multiselect-dropdown>
                      </div>
                    </ng-container>
                  </form>
                </div>

                <!-- /.toolpills -->

              </div>
              <!-- /.card-heading -->
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-sticky table-collaps mb-0">
                    <thead class="grid-header">
                      <tr class="nestedrow">
                        <ng-container *ngFor="let key of currentHeaderKeys; let i=index">
                          <th *ngIf="showColumn[i] === 'true'" class="grid-header">
                            <i class="fa fa-caret-right showCarret" *ngIf="i === 0" [ngStyle]="{'margin-right': i == 0 ? '13px' : '0px', 'color':'#2f4151'}"></i>
                            {{currentTableHeader[key]}}
                          </th>
                        </ng-container>
                      </tr>
                    </thead>
                    <tbody class="table_body_audit">
                      <ng-container *ngFor="let pageData of currentPage | filter:searchData; let i=index">
                        <tr class="nestedrow" class="grid-row">
                          <ng-container *ngFor="let dataKey of currentHeaderKeys; let j=index">
                            <td *ngIf="showColumn[j] === 'true'">
                              <div *ngIf="dataKey.includes('Time'); then thenBlock else elseBlock"></div>
                              <ng-template #thenBlock><span>{{+pageData[dataKey] | date:'medium'}}</span></ng-template>
                              <ng-template #elseBlock><span
                                  class="{{dataKey === 'status' ? getClass(pageData[dataKey]) : ''}}"><i *ngIf="j === 0"
                                    class="fa fa-caret-right carret {{j === 0 && pageData[treeView_currentKey] ?'showCarret':'hiddenCarret'}}"
                                    id="treeview{{i}}"
                                    (click)="onClickNestedRow(i,$event,pageData['applicationName'],pageData['pipelineConfigId'],pageData['eventId'])"
                                    style="transition: transform 400ms ease-in-out;margin-right: 15px;"></i>{{pageData[dataKey]}}</span>
                              </ng-template>
                            </td>
                          </ng-container>
                        </tr>
                        <tr class="nested_tr">
                          <ng-container *ngIf="treeView[i]">
                            <td [attr.colspan]="currentHeaderKeys.length" class="inner-table">
                              <div [@expandableRow]="treeView_rowanimation">
                                <app-tree-view></app-tree-view>
                              </div>
                            </td>
                          </ng-container>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                  <!-- /.table -->
                </div>
                <!-- /.table-responisve -->
              </div>
              <!-- /.card-body -->
              <div class="card-footer table-footer px-3 py-2">
                <div class="form-inline {{searchData !== ''?'disabledFooter':''}}">
                  <span class="mr-2">Per page</span>
                  <select class="form-control" [(ngModel)]="perPageData" (change)="onChangePerPageData()">
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                    <option value="25">25</option>

                  </select>
                  <span class="ml-3 mr-2">Showing {{currentDatalength>0?page.startingPoint+1:0}} to
                    {{page.endPoint < currentDatalength && page.endPoint > page.startingPoint ? page.endPoint:currentDatalength}}
                    of
                    {{currentDatalength}}</span>
                  <!-- <input type="text" class="form-control mr-2" />
                  <button class="btn btn-primary">Go</button> -->

                  <ul class="pagination ml-auto mb-0">
                    <li class="page-item" (click)="pagePrev()" class="{{page.startingPoint === 0?'disabledbtn':''}}"><a
                        class="page-link">Previous</a></li>
                    <li class="page-item {{page.currentPage === page.pageNo ? 'active' : ''}}"
                      (click)=showPage(page.currentPage)><a class="page-link">{{page.currentPage}}</a></li>
                    <li class="page-item {{page.currentPage+1 === page.pageNo ? 'active' : ''}}" *ngIf="(page.pageNo*page.pageSize) < currentDatalength || 
                              page.currentPage+1 == page.pageNo || page.currentPage+1 == page.pageNo-1 ? true : false"
                      (click)=showPage(page.currentPage+1)><a class="page-link">{{page.currentPage+1}}</a></li>
                    <li class="page-item {{page.currentPage+2 === page.pageNo ? 'active' : ''}}"
                      *ngIf="((page.pageNo+1)*page.pageSize) < currentDatalength || 
                               page.currentPage+2 == page.pageNo ||
                               ((page.currentPage+2)*page.pageSize< currentDatalength? true : ((page.currentPage+2)*page.pageSize)-currentDatalength < page.pageSize? true : false) ? true : false"
                      (click)=showPage(page.currentPage+2)><a class="page-link">{{page.currentPage+2}}</a></li>
                    <li class="page-item" (click)="pageNext()"
                      class="{{page.endPoint === currentDatalength?'disabledbtn':''}}"><a class="page-link">Next</a>
                    </li>
                  </ul>
                </div>
                <!-- /.per_page -->
              </div>
              <!-- /.card-footer -->
            </div>
            <div class="card" *ngIf="currentTabData !== null && currentTabData['results'].length == 0">
              <app-component-error-listing class="emptyTableError"
                [errorString]="'Data is being retrieved. Please try refreshing after sometime.'">
              </app-component-error-listing>
            </div>
            <div class="card" *ngIf="currentTabData === null">
              <app-component-error-listing class="emptyTableError"
                [errorString]="'Selected tab data does not exist in database. If you are sure that these are there, please refresh the page after sometime.'">
              </app-component-error-listing>
            </div>
          </ng-container>

          <div class="card" *ngIf="auditLoading">
            <app-loading-screen></app-loading-screen>
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col-12 -->
      </div>
      <!-- /.row -->
    </div>
  </div>
  <!-- /.page-content -->
</div>