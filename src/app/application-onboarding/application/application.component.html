<div class="tab-content h-100 p-3 flex-grow-1">
  <div *ngIf = "!apploading" class="tab-pane d-flex flex-column bg-white h-100 fade show active">
    <div class="page_access text-right py-2 px-3">
      <button class="btn btn-default ml-1" (click)="cancelForm()">Cancel</button>
      <!-- <button class="btn btn-default ml-2" disabled="disabled">Save</button> -->
      <button class="btn btn-primary ml-2" (click)="SubmitForm()">Save & Finish</button>
    </div>
    <!-- /.page_access ml-auto -->
    <div class="setup-content">
      <div class="row">
  
        <!-- ###################### Tree Section Starts #####################################-->
  
        <div class="col-sm-3">
          <div class="sidebar-tree">
            <ul class="tree-inset  list-unstyled {{createApplicationForm.value.name !== ''?'tree-active':''}}">
              <li class="ti-title">
                <i class="{{createApplicationForm.value.name !== ''?'fas fa-check-circle':'far fa-dot-circle'}}"></i>
                <span>Application Details</span>
              </li>
              <li class="ti-item">
                <i class="{{createApplicationForm.value.name !== ''?'fas fa-check-circle':'far fa-dot-circle'}}"></i>
                <span>Application Name :</span>
                <strong>{{createApplicationForm.value.name}}</strong>
              </li>
              <li class="ti-item">
                <i class="{{createApplicationForm.value.emailId !== ''?'fas fa-check-circle':'far fa-dot-circle'}}"></i>
                <span>Email :</span>
                <strong>{{createApplicationForm.value.emailId}}</strong>
              </li>
              <li class="ti-item">
                <i class="{{createApplicationForm.getRawValue().imageSource !== ''?'fas fa-check-circle':'far fa-dot-circle'}}"></i>
                <span>Image Source :</span>
                <strong>{{createApplicationForm.getRawValue().imageSource}}</strong>
              </li>
              <li class="ti-item">
                <i class="{{createApplicationForm.value.description !== ''?'fas fa-check-circle':'far fa-dot-circle'}}"></i>
                <span>Description :</span>
                <strong>{{createApplicationForm.value.description}}</strong>
              </li>
              <br>
              <br>
            </ul>
            
            <ul class="tree-inset list-unstyled {{serviceArr.serviceName !== '' ? 'tree-active' : ''}}" *ngFor="let serviceArr of servicesForm.value.services; let i = index">
              <li class="ti-title">
                <i class="{{serviceArr.serviceName !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>Service {{i+1}}</span>
              </li>
              <br>
              <li class="ti-item">
                <i class="{{serviceArr.serviceName !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>Service name</span>
                <strong>{{serviceArr.serviceName}}</strong>
              </li>
              <br>
              <br>
            </ul>
           
            <ul class="tree-inset list-unstyled {{environmentForm.value.environments[0].key !== '' ? 'tree-active' : ''}}"
              *ngIf="environmentForm.value.environments.length !== 0 ? true : false ">
              <li class="ti-title">
                <i class="{{environmentForm.value.environments[0].key !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>Environment Details</span>
              </li>
              <li class="ti-item" *ngFor="let env of environmentForm.value.environments; let index = i">
                <i class="{{env.value !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>{{env.key !== ''? env.key : ''}} :</span>
                <strong *ngIf="env.value !== ''? true:false">{{env.value !== ''? env.value : ''}}</strong>
              </li>
            </ul>
            
            <ul class="tree-inset list-unstyled {{groupPermissionForm.value.userGroups[0].userGroup !== '' ? 'tree-active' : ''}}"
              *ngIf="groupPermissionForm.value.userGroups.length > 0 ? true : false ">
              <li class="ti-title">
                <i class="{{groupPermissionForm.value.userGroups[0].userGroup !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>Group Permissions Details</span>
              </li>
              <li class="ti-item" *ngFor="let group of groupPermissionForm.value.userGroups; let index = i">
                <i class="{{group.permission !== '' ? 'fas fa-check-circle' : 'far fa-dot-circle'}}"></i>
                <span>{{group.userGroup !== ''?group.userGroup:''}} :</span>
                <strong *ngIf="group.permission !== ''? true:false">{{group.permission !== ''?group.permission:''}}</strong>
              </li>
            </ul>
           
            <ul class="tree-inset tree-finished list-unstyled {{groupPermissionForm.valid && createApplicationForm.valid && servicesForm.valid && environmentForm.valid ? 'tree-active' : ''}}">
              <li class="ti-title">
                <i class="{{groupPermissionForm.valid && createApplicationForm.valid && servicesForm.valid ? 'fas fa-circle' : 'far fa-circle'}}"></i>
                <span>Finish Application</span>
              </li>
            </ul>
           
          </div>
        </div>
       
  
        <!-- ###################### Tree Section Ends #####################################-->
  
        <div class="col-sm-9">
          <div class="p-3">
            <div class="row">
  
              <!-- ###################### Application Section Starts #####################################-->
  
              <div class="col-6">
                <form [formGroup]="createApplicationForm">
                  <div class="form-group">
                    <label>Application Name</label>
                    <input type="text" class="form-control" formControlName="name" [readonly]="editMode" [ngClass]="createApplicationForm.get('name').invalid && createApplicationForm.get('name').touched ? 'is-invalid':''">
                    <span *ngIf="createApplicationForm.get('name').invalid && createApplicationForm.get('name').touched"
                      class="invalid-feedback">
                      <span *ngIf="createApplicationForm.get('name').errors['required']">Application Name is
                        required</span>
                      <span *ngIf="createApplicationForm.get('name').errors['applicationExist']">Application already
                        exists with same name. Please choose a unique application name</span>
                      <span *ngIf="createApplicationForm.get('name').errors['containSpace']">Space is not allowed in application name</span>
                      <span *ngIf="createApplicationForm.get('name').errors['startingFromNumber']">The application name must begin with a letter.</span>
                      <span *ngIf="createApplicationForm.get('name').errors['symbols']">No Special characters are allowed.</span>
                    </span>
                  </div>
                  <div class="form-group">
                    <label>Email Id</label>
                    <input type="text" class="form-control" formControlName="emailId" [readonly]="editMode" [ngClass]="createApplicationForm.get('emailId').invalid && createApplicationForm.get('emailId').touched ? 'is-invalid':''">
                    <span *ngIf="createApplicationForm.get('emailId').invalid && createApplicationForm.get('emailId').touched" class="invalid-feedback">
                      <span *ngIf="createApplicationForm.get('emailId').errors['required']">Email is required</span>
                      <span *ngIf="createApplicationForm.get('emailId').errors['email']">Please enter valid Email Id</span>
                    </span>
                  </div>
                  <!-- /.form-group -->
                  <div class="form-group">
                    <label>Image Source</label>
                    <select class="form-control" formControlName="imageSource" (change)="onImageSourceSelect($event.target.value)"
                    [ngClass]="createApplicationForm.get('imageSource').invalid && createApplicationForm.get('imageSource').touched?'is-invalid':''">
                      <option value="" [disabled]="true">Select</option>
                      <option *ngFor="let imageData of imageSourceData" value="{{imageData.name}}">{{imageData.name}}</option>
                    </select>
                    <span *ngIf="createApplicationForm.get('imageSource').invalid && createApplicationForm.get('imageSource').touched"
                      class="invalid-feedback">
                      Image Source is required
                    </span>
                  </div>
                  <!-- /.form-group -->
                  <div class="form-group">
                    <label>Application Description</label>
                    <textarea class="form-control" rows="3" formControlName="description" [readonly]="editMode"></textarea>
                  </div>
                </form>
              </div>
              <!-- /.col-6 -->
  
              <!-- ###################### Application Section Ends #####################################-->
  
              <!-- ###################### Services Section Starts #####################################-->
  
              <div class="col-10">
                <hr class="ml-0 mt-3 mb-3" />
              </div>
              <!-- /.col-8 -->
              <div class="col-6">
                <form [formGroup]="servicesForm">
                  <div class="form-group service_section">
                    <label>Services</label>
                   
                    <!-- /.d-flex -->
  
                    <div class="col-12" formArrayName="services">
                      <div class="row" *ngFor="let serviceArr of servicesForm.get('services')['controls']; let i=index">
                        <div class="col-12 " [formGroupName]="i">
                          <div class="col-12 ">
                            <hr class="ml-0 mt-3 mb-3" />
                          </div>
                          <div class="form-group mb-3 pl-4 text-muted">
                            <label>Service Name</label>
                            <div class="d-flex  mr-4 align-items-center">
                              <input type="text" class="form-control input_len" formControlName="serviceName" [readonly]="isReadonly(i)" 
                              [ngClass]="servicesForm.get('services')['controls'][i].get('serviceName').invalid && servicesForm.get('services')['controls'][i].get('serviceName').touched ? 'is-invalid':''">
                              <a class="text-muted ml-3 formarray_btn"  data-toggle="tooltip" data-placement="right" title="Delete Service" 
                              (click)="deleteService(i)" *ngIf ="servicesForm.get('services')['controls'].length > 1 ? true : false">
                                <i class="fas fa-trash-alt"></i></a>
                              </div>
                              <span *ngIf="servicesForm.get('services')['controls'][i].get('serviceName').invalid && servicesForm.get('services')['controls'][i].get('serviceName').touched"
                              class="help-block">
                              <span *ngIf="servicesForm.get('services')['controls'][i].get('serviceName').errors['required']">Service name is required</span>
                              <span *ngIf="servicesForm.get('services')['controls'][i].get('serviceName').errors['containSpace']">Space is not allowed in Service Name</span>
                              <span *ngIf="servicesForm.get('services')['controls'][i].get('serviceName').errors['startingFromNumber']">The service name must begin with a letter.</span>
                              <span *ngIf="servicesForm.get('services')['controls'][i].get('serviceName').errors['symbols']">No Special characters are allowed.</span>
                            </span>
                            <!-- /.d-flex -->
                          </div>
                          <div class="col-12 " formArrayName="pipelines">
                            <div class="row"
                              *ngFor="let pipelineArr of serviceArr.get('pipelines')['controls'];let j=index">
                              <div class="col-12 " [formGroupName]="j">
                                <div class="form-group mb-3 pl-5 text-muted">
                                  <label>Select Service Pipeline</label>
                                  <div class="d-flex  mr-5 align-items-center">
                                    <select class="form-control" formControlName="pipelinetemplate" (change)="onPipelineSelect(i,j,$event.target.value)"
                                    [ngClass]="!pipelineArr.get('pipelinetemplate').valid && pipelineArr.get('pipelinetemplate').touched ? 'is-invalid':''">
                                      <option value="" [disabled]="true">Select</option>
                                      <option *ngFor="let pipelineData of pipelineExists" value="{{pipelineData.name}}">{{pipelineData.name}}</option>
                                    </select>
                                    <!-- <a class="text-muted ml-3 formarray_btn"><i class="fas fa-plus"></i></a> -->
                                  </div>
                                  <span *ngIf="!pipelineArr.get('pipelinetemplate').valid && pipelineArr.get('pipelinetemplate').touched"
                                  class="help-block">Pipeline is required</span>
                                </div>
                                <!-- <div class="form-group mb-3 pl-5 text-muted">
                                  <label>Cloud Account</label>
                                  <div class="d-flex  mr-5 align-items-center">
                                    <select class="form-control" formControlName="cloudAccount"
                                    [ngClass]="!pipelineArr.get('cloudAccount').valid && pipelineArr.get('cloudAccount').touched ? 'is-invalid':''">
                                      <option *ngFor="let cloudData of cloudAccountExist" value="{{cloudData.name}}">{{cloudData.name}}</option>
                                    </select>
                                  </div>
                                  <span *ngIf="!pipelineArr.get('cloudAccount').valid && pipelineArr.get('cloudAccount').touched"
                                  class="help-block">Cloud Account is required</span>
                                </div> -->
                                <div class="form-group mb-3 pl-5 text-muted">
                                  <label>Docker Account & Image Name</label>
                                  <div class="d-flex  mr-5 align-items-center">
                                      <div class="col-5 dockerImageSource">
                                        <select class="form-control customAcc {{isReadonly(i)?'disabledinput':''}}" value="{{dockerAccountName}}" (change)="onChangeDockerAcc($event,i)" [disabled]="isReadonly(i)" 
                                        [ngClass]="!pipelineArr.get('dockerImageName').valid && pipelineArr.get('dockerImageName').touched ? 'wheninvalid':''">
                                          <option value="" [disabled]="true">Select</option>
                                          <option *ngFor="let dockerimages of dockerImageData" value="{{dockerimages.imageSource}}">{{dockerimages.imageSource}}</option>
                                        </select>
                                      </div>
                                      <div class="col-7 dockerImageSource">
                                        <select class="form-control customImg" formControlName="dockerImageName" 
                                        [ngClass]="!pipelineArr.get('dockerImageName').valid && pipelineArr.get('dockerImageName').touched ? 'is-invalid':''">
                                          <option value="" [disabled]="true">Select</option>
                                          <option *ngFor="let dockerimages of dockerImageDropdownData[i]" value="{{dockerimages}}">{{dockerimages}}</option>
                                        </select>
                                      </div>
                                  </div>
                                  <span *ngIf="!pipelineArr.get('dockerImageName').valid && pipelineArr.get('dockerImageName').touched"
                                  class="help-block">Docker Image Name is required</span>
                                </div>
                                <div class="col-12 " formArrayName="pipelineParameters">
                                  <div class="row" *ngFor="let pipelineParameterArr of pipelineArr.get('pipelineParameters')['controls']; let k=index">
                                    <div class="col-12 " [formGroupName]="k">
                                      <div class="form-group mb-3 pl-6 text-muted">
                                        <label>{{pipelineParameterArr.get('name').value}}</label>
                                        <div class="d-flex mr-6 align-items-center">
                                          <input *ngIf = "pipelineParameterArr.get('type').value !== 'boolean'" type="{{pipelineParameterArr.get('type').value === 'string'? 'text' : 'number'}}" 
                                          class="form-control" placeholder="{{getProperValue(i,j,k)}}" formControlName="value" (change)="onChangeValue(i,j,k,$event)"
                                          [ngClass]="!pipelineParameterArr.get('value').valid && pipelineParameterArr.get('value').touched ? 'is-invalid':''">
                                          <select *ngIf = "pipelineParameterArr.get('type').value === 'boolean'" class="form-control" formControlName="value"
                                          [ngClass]="!pipelineParameterArr.get('value').valid && pipelineParameterArr.get('value').touched ? 'is-invalid':''">
                                            <option value="">Select</option>
                                            <option value="True">True</option>
                                            <option value="False">False</option>
                                          </select>
                                        </div>
                                        <span *ngIf="!pipelineParameterArr.get('value').valid && pipelineParameterArr.get('value').touched"
                                                class="help-block">{{pipelineParameterArr.get('name').value}} is required</span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 ">
                      <hr class="ml-0 mt-3 mb-3" />
                    </div>
                    <div class="col-6">
                      <a class="btn btn-link btn-link-black" (click)="addService()">Add another Service</a>
                    </div>
                  </div>
                </form>
              </div>
              <!-- /.col-6 -->
  
              <!-- ###################### Services Section Ends #####################################-->
  
               <!-- ###################### Environment Section Starts ###########################-->
  
               <div class="col-10">
                <hr class="ml-0 mt-3 mb-3" />
              </div>
              <!-- /.col-8 -->
              <div class="col-lg-8 col-12 col-xl-6">
                <div class="form-group group_permission">
                  <label>Environments</label>
                  <div class="col-12">
                    <hr class="ml-0 mt-3 mb-3" />
                  </div>
                  <div class="row" *ngIf="environmentForm.value.environments.length !== 0 ? true : false ">
                    <div class="col-12">
                      <form [formGroup]="environmentForm">
                        <table class="table table-outline" formArrayName="environments">
                          <thead>
                            <tr>
                              <th>Key</th>
                              <th>Value</th>
                              <th class="text-right"><a (click)="addEnvironment()" data-toggle="tooltip" data-placement="top" data-original-title="Add New Environment"><i class="fas fa-plus"></i></a></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let optionsArr of environmentForm.get('environments')['controls'];let i=index">
                              <ng-container [formGroupName]="i">
                                <td>
                                  <input type="text" class="form-control" formControlName="key" (change)="onEnvironmentUpdate(i,'key',$event)"
                                  [ngClass]="!environmentForm.get('environments')['controls'][i].get('key').valid && environmentForm.get('environments')['controls'][i].get('key').touched ? 'is-invalid':''">
                                  <span *ngIf="!environmentForm.get('environments')['controls'][i].get('key').valid && environmentForm.get('environments')['controls'][i].get('key').touched"
                                  class="invalid-feedback">Key is required</span>
                                </td>
                                <td>
                                  <input type="text" class="form-control" formControlName="value" (change)="onEnvironmentUpdate(i,'value',$event)">
                                </td>
                                <td>
                                  <a class="text-muted formarray_btn"  data-toggle="tooltip" data-placement="right" title="Delete"
                                  (click)="removeEnvironment(i)">
                                    <i class="mt_custom-3 fas fa-trash-alt"></i></a>
                                </td>
                              </ng-container>
                            </tr>
                          </tbody>
                        </table>
                      </form>
                    </div>
                  </div>
                  <div class="col-6">
                    <a class="btn btn-link btn-link-black" *ngIf="environmentForm.value.environments.length === 0 ? true : false " (click)="addEnvironment()">Add Environment</a>
                  </div>
                </div>
                <!-- /.form-group -->
              </div>
              <!-- /.col-6 -->
  
              <!-- ###################### Environment Section Ends ###########################-->
  
              <!-- ###################### Group Permission Section Starts ###########################-->
  
              <div class="col-10">
                <hr class="ml-0 mt-3 mb-3" />
              </div>
              <!-- /.col-8 -->
              <div class="col-lg-8 col-12 col-xl-6">
                <div class="form-group group_permission">
                  <label>Group Permissions</label>
                  <div class="col-12">
                    <hr class="ml-0 mt-3 mb-3" />
                  </div>
                  <div class="row" *ngIf="groupPermissionForm.value.userGroups.length !== 0 ? true : false ">
                    <div class="col-12">
                      <form [formGroup]="groupPermissionForm">
                        <table class="table table-outline" formArrayName="userGroups">
                          <thead>
                            <tr>
                              <th>Group</th>
                              <th>Permissions</th>
                              <th class="text-right"><a (click)="addGroup()" data-toggle="tooltip" data-placement="top" data-original-title="Add New Group"><i class="fas fa-plus"></i></a></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let optionsArr of groupPermissionForm.get('userGroups')['controls'];let i=index">
                              <ng-container [formGroupName]="i">
                                <td>
                                  <input type="text" class="form-control" formControlName="userGroup"
                                  [ngClass]="!groupPermissionForm.get('userGroups')['controls'][i].get('userGroup').valid && groupPermissionForm.get('userGroups')['controls'][i].get('userGroup').touched ? 'is-invalid':''">
                                  <span *ngIf="!groupPermissionForm.get('userGroups')['controls'][i].get('userGroup').valid && groupPermissionForm.get('userGroups')['controls'][i].get('userGroup').touched"
                                  class="invalid-feedback">Group name is required</span>
                                </td>
                                <td>
                                  <select class="form-control" formControlName="permission"
                                  [ngClass]="!groupPermissionForm.get('userGroups')['controls'][i].get('permission').valid && groupPermissionForm.get('userGroups')['controls'][i].get('permission').touched ? 'is-invalid':''">
                                    <option value="Read Only">Read Only</option>
                                    <option value="Read & Write">Read & Write</option>
                                    <option value="Read,Write & Execute">Read,Write & Execute</option>
                                  </select>
                                  <span *ngIf="!groupPermissionForm.get('userGroups')['controls'][i].get('permission').valid && groupPermissionForm.get('userGroups')['controls'][i].get('permission').touched"
                                  class="invalid-feedback">Permission is required</span>
                                </td>
                                <td>
                                  <a class="text-muted formarray_btn"  data-toggle="tooltip" data-placement="right" title="Delete" 
                                  (click)="removeGroup(i)">
                                    <i class="mt_custom-3 fas fa-trash-alt"></i></a>
                                </td>
                              </ng-container>
                            </tr>
                          </tbody>
                        </table>
                      </form>
                    </div>
                  </div>
                  <div class="col-6">
                    <a class="btn btn-link btn-link-black" *ngIf="groupPermissionForm.value.userGroups.length === 0 ? true : false " (click)="addGroup()">Add Group</a>
                  </div>
                </div>
                <!-- /.form-group -->
              </div>
              <!-- /.col-6 -->
  
              <!-- ###################### Group Permission Section Ends ###########################-->
  
            </div>
            <!-- /.row -->
          </div>
  
  
  
          <div class="p-3 bottom-strp-cover gray-strip text-right">
            <button class="btn btn-default" (click)="cancelForm()">Cancel</button>
            <!-- <button class="btn btn-default ml-2" disabled="disabled">Save</button> -->
            <button class="btn btn-primary ml-2" (click)="SubmitForm()">Save & Finish</button>
          </div>
        </div>
        <!-- /.col-sm-9 -->
      </div>
      <!-- /.row -->
    </div>
    <!-- /.setup-content -->
  </div>
  <div *ngIf = "apploading" class="tab-pane d-flex flex-column bg-white h-100 fade show active">
    <app-loading-screen></app-loading-screen>
  </div>
</div>
